
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>8. Contrôle du FetchBot et reconnaissance d’images avec Python &#8212; Rover martien intelligent FetchBot</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/book.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/gtag_0.js"></script>
    <script src="../../_static/gtag_1.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script >const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/fetch-rover-small.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="9. Raspberry Pi: Prise en main et préparation" href="../../4_Additional_Resources/Raspberry_Pi/Raspberry_Pi.html" />
    <link rel="prev" title="7. Contrôle du FetchBot et reconnaissance d’images avec Scratch" href="../FetchBot_Control_IR_Scratch/FetchBot_Control_IR_Scratch.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/fetch-rover-small.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Rover martien intelligent FetchBot</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Overview.html">
   FetchBot: Rover martien intelligent
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Reconnaissance d'images
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../1_Image_Recognition/Image_Recognition/Image_Recognition.html">
   1. Reconnaissance d’images avec la Teachable Machine
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1_Image_Recognition/Image_Recognition_Scratch/Image_Recognition_Scratch.html">
   2. Reconnaissance d’images avec Scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../1_Image_Recognition/Image_Recognition_Python/Image_Recognition_Python.html">
   3. Reconnaissance d’images avec Python
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Construction du rover
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../2_Rover_Building/Rover_Building/Rover_Building.html">
   4. Construction du FetchBot
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../2_Rover_Building/FetchBot_Control_Scratch/FetchBot_Control_Scratch.html">
   5. Contrôle du FetchBot avec Scratch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../2_Rover_Building/FetchBot_Control_Python/FetchBot_Control_Python.html">
   6. Contrôle du FetchBot avec Python
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Contrôle intelligent du rover
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../FetchBot_Control_IR_Scratch/FetchBot_Control_IR_Scratch.html">
   7. Contrôle du FetchBot et reconnaissance d’images avec Scratch
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   8. Contrôle du FetchBot et reconnaissance d’images avec Python
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Ressources complémentaires
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../4_Additional_Resources/Raspberry_Pi/Raspberry_Pi.html">
   9. Raspberry Pi: Prise en main et préparation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../4_Additional_Resources/Fetch_Mission_Engineer.html">
   10. Ingénieur mission Fetch
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../4_Additional_Resources/Rover_Alternatives.html">
   11. Alternatives de rover
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../4_Additional_Resources/FAQ.html">
   12. FAQ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../4_Additional_Resources/Troubleshooting.html">
   13. Dépannage
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/3_Rover_Camera_Control/FetchBot_Control_IR_Python/FetchBot_Control_IR_Python.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/lascientotheque/fetchbot-fr"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/lascientotheque/fetchbot-fr/issues/new?title=Issue%20on%20page%20%2F3_Rover_Camera_Control/FetchBot_Control_IR_Python/FetchBot_Control_IR_Python.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/lascientotheque/fetchbot-fr/edit/main/3_Rover_Camera_Control/FetchBot_Control_IR_Python/FetchBot_Control_IR_Python.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/lascientotheque/fetchbot-fr/main?urlpath=tree/3_Rover_Camera_Control/FetchBot_Control_IR_Python/FetchBot_Control_IR_Python.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/lascientotheque/fetchbot-fr/blob/main/3_Rover_Camera_Control/FetchBot_Control_IR_Python/FetchBot_Control_IR_Python.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#apercu">
   8.1. Aperçu
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparation">
   8.2. Préparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creation-du-modele-de-reconnaissance-d-images">
   8.3. Création du modèle de reconnaissance d’images
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reconnaissance-d-image">
   8.4. Reconnaissance d’image
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#controle-du-rover-avec-la-reconnaissance-d-image">
   8.5. Contrôle du rover avec la reconnaissance d’image
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="controle-du-fetchbot-et-reconnaissance-d-images-avec-python">
<h1><span class="section-number">8. </span>Contrôle du FetchBot et reconnaissance d’images avec Python<a class="headerlink" href="#controle-du-fetchbot-et-reconnaissance-d-images-avec-python" title="Permalink to this headline">¶</a></h1>
<p><strong>Objectif:</strong> Faire déplacer le FetchBot avec Python en utilisant la reconnaissance d’images.</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="text-align:left head"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Âge</p></td>
<td class="text-align:left"><p>14 à 18 ans</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Notions abordées</p></td>
<td class="text-align:left"><p>Intelligence artificielle, classification d’images, robotique, programmation avec Scratch, condition, boucle.</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Durée</p></td>
<td class="text-align:left"><p>4 heures</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Dispositif pédagogiques</p></td>
<td class="text-align:left"><p>Par groupe de 2</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Matériel</p></td>
<td class="text-align:left"><p>Un FetchBot et un laptop/tablette par groupe de 2, avec connexion à Internet</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Prérequis</p></td>
<td class="text-align:left"><p>1. Connaissances de bases de Python (voir Activité 3 - Reconnaissance d’images avec Python)<br> 2. Avoir pris en main le Raspberry Pi, et savoir s’y connecter avec VNC viewer (voir <a class="reference internal" href="../../4_Additional_Resources/Raspberry_Pi/Raspberry_Pi.html#raspberry-pi"><span class="std std-ref">Raspberry Pi: Prise en main et préparation</span></a>)<br> 3. Avoir construit le FetchBot (voir <a class="reference internal" href="../../2_Rover_Building/Rover_Building/Rover_Building.html#rover-building"><span class="std std-ref">Activité 4 - Construction du rover</span></a>)<br> 4. Avoir programmé le FetchBot pour le faire se déplacer (voir <a class="reference internal" href="../../2_Rover_Building/FetchBot_Control_Python/FetchBot_Control_Python.html#fetchbot-control-python"><span class="std std-ref">Activité 6 - Contrôle du FetchBot avec Python</span></a>)</p></td>
</tr>
</tbody>
</table>
<div class="section" id="apercu">
<h2><span class="section-number">8.1. </span>Aperçu<a class="headerlink" href="#apercu" title="Permalink to this headline">¶</a></h2>
<p>Dans cette activité, tu vas programmer le FetchBot pour le faire explorer un terrain et retrouver un objet. On utilisera comme exemple ici la recherche d’un tube sur un sol martien, comme ce que devra faire le rover Fetch sur mars. Tu utiliseras la reconnaissance d’images pour contrôler ce que fais le rover: Faire avancer le robot lorsque le terrain est dégagé, le faire tourner lorsqu’il rencontre un obstacle, et le faire s’arrêter lorsqu’il trouve le tube.</p>
<a class="reference internal image-reference" href="../../_images/Fetchbot_Moving.gif"><img alt="../../_images/Fetchbot_Moving.gif" src="../../_images/Fetchbot_Moving.gif" style="width: 600px;" /></a>
<p>L’activité se compose de trois parties principales:</p>
<ul class="simple">
<li><p>Créer un modèle de reconnaissance d’images capable de détecter 3 types de classes: le sol dégagé, les obstacles, et les tubes</p></li>
<li><p>Utiliser le modèle de reconnaissance d’images dans un programme Scratch pour faire dire au sprite de rover la classe détectée (comme dans l’activité 2)</p></li>
<li><p>Rajouter à ce programme Scratch l’envoi de commandes au rover en fonction de la classe détectée.</p></li>
</ul>
<p>La <a class="reference external" href="https://www.youtube.com/watch?v=52H9oy993JY">vidéo de ce lien</a> te donne un aperçu de la réalisation de ces activités.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>L’activité peut être adaptée pour la recherche d’autres objets (crayon, pièce de légo, …) et sur d’autres types de terrains, par exemple le sol de ta classe, ou même un terrain en extérieur.</p>
</div>
</div>
<div class="section" id="preparation">
<h2><span class="section-number">8.2. </span>Préparation<a class="headerlink" href="#preparation" title="Permalink to this headline">¶</a></h2>
<p>Ton <a class="reference internal" href="../../2_Rover_Building/Rover_Building/Rover_Building.html#rover-building"><span class="std std-ref">rover est construit</span></a>, et tu y es <a class="reference internal" href="../../4_Additional_Resources/Raspberry_Pi/Raspberry_Pi.html#raspberry-pi"><span class="std std-ref">connecté avec VNC viewer</span></a> depuis un ordinateur ou une tablette.</p>
<p>Il te faudra ensuite choisir un objet que le rover devra retrouver, et délimiter une zone dans laquelle le rover devra rechercher cet objet. Pour l’objet, tu peux choisir un tube, un crayon, une pièce de légo, ou autre. Pour la zone de recherche, tu peux imprimer un <a class="reference external" href="https://www.esa.int/ESA_Multimedia/Images/2019/12/Mars_terrain">sol martien</a> au format A0 ou sous forme de tapis, ou sinon délimiter une zone avec du ruban adhésif. Tu pourras ajouter dans la zone des obstacles à éviter (cailloux, boites, ou autre).</p>
</div>
<div class="section" id="creation-du-modele-de-reconnaissance-d-images">
<h2><span class="section-number">8.3. </span>Création du modèle de reconnaissance d’images<a class="headerlink" href="#creation-du-modele-de-reconnaissance-d-images" title="Permalink to this headline">¶</a></h2>
<p>La création du modèle suit le même principe que celui décrit dans <a class="reference internal" href="../../1_Image_Recognition/Image_Recognition/Image_Recognition.html#image-recognition"><span class="std std-ref">l’activité 1 - Reconnaissance d’images avec la Teachable Machine</span></a>. Il te faudra ici prendre des exemples d’images pour trois classes:</p>
<ul class="simple">
<li><p>le sol dégagé: classe ‘sol’. Les exemples peuvent inclure ici toute partie de la zone où le robot peut avancer, c’est à dire qui ne contient ni obstacle, ni tube.</p></li>
<li><p>les obstacles: classe ‘obstacle’. Les exemples peuvent inclure ici toute partie de la zone où le robot est face à un obstacle, comme un bord, un autre robot, ou des objets à éviter comme des cailloux.</p></li>
<li><p>le tube à retrouver: classe ‘tube’. Les exemples peuvent inlcure ici toute partie de la zone où le robot est devant un tube.</p></li>
</ul>
<p>Ouvre un projet d’images dans la Teachable Machine, et crée trois catégories ‘Sol’, ‘Obstacle’, et ‘Tube’.</p>
<a class="reference internal image-reference" href="../../_images/TM_Classes.jpg"><img alt="../../_images/TM_Classes.jpg" src="../../_images/TM_Classes.jpg" style="width: 800px;" /></a>
<p>Pour chaque classe, il est en général suffisant de prendre une vingtaine d’exemples. Essaye de varier au maximum les exemples que tu prends (angle ou distance par rapport à un obstacle ou un tube, luminosité, reflet sur le sol, etc…).</p>
<p>La <a class="reference external" href="https://www.youtube.com/watch?v=52H9oy993JY">vidéo ici</a> (partie ‘Training’, de 1’13 à 3’53) te montre comment faire cela en pratique.</p>
<p>Après avoir pris une vingtaine d’exemples pour chaque classe, entraîne le modèle. Tu peux ensuite tester si le modèle reconnaît correctement les trois classes. L’interface devrait de la Teachable Machine devrait ressembler à ceci:</p>
<a class="reference internal image-reference" href="../../_images/TM_Examples.jpg"><img alt="../../_images/TM_Examples.jpg" src="../../_images/TM_Examples.jpg" style="width: 800px;" /></a>
<p>Ici, un tube est devant la caméra, et le modèle reconnaît correctement (classe ‘Tube’ détectée à 100%).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Il est plus facile d’être deux pour prendre les exemples d’images des trois classes: un pour déplacer le rover dans la zone, et l’autre pour prendre les photos sur la Teachable Machine.</p>
</div>
</div>
<div class="section" id="reconnaissance-d-image">
<h2><span class="section-number">8.4. </span>Reconnaissance d’image<a class="headerlink" href="#reconnaissance-d-image" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Necessary import</span>
<span class="kn">import</span> <span class="nn">cv2</span> <span class="c1"># cv2 is used to take image from the camera</span>
<span class="kn">import</span> <span class="nn">myfunctions</span> <span class="c1"># myfunctions helps for taking picture and making predictions</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1"># matplotlib is used to deal with images</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="c1"># PIL is used to deal with images</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="c1"># time is used for making the computer wait</span>

<span class="c1"># Get camera object</span>
<span class="n">camera_object</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">camera_object</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_BUFFERSIZE</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Initialize model</span>
<span class="n">interpreter</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">initialize_model</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="s1">&#39;model.tflite&#39;</span><span class="p">)</span>

<span class="c1"># Infinite loop</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    
    <span class="c1"># Wait for one second</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Take image from the camera</span>
    <span class="n">picture_rgb</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">take_picture</span><span class="p">(</span><span class="n">camera_object</span><span class="p">)</span>
    
    <span class="c1"># Predict image class</span>
    <span class="n">prediction</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">model_prediction</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="n">picture_rgb</span><span class="p">)</span>
    
    <span class="c1"># If prediction is class 0, class is &#39;Tube&#39;</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Je reconnais la classe &#39;Tube&#39;&quot;</span><span class="p">)</span>
        
    <span class="c1"># If prediction is class 1, class is &#39;Autre&#39;</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Je reconnais la classe &#39;Other&#39;&quot;</span><span class="p">)</span>
        
        <span class="c1"># If prediction is class 2, class is &#39;Bord&#39;</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Je reconnais la classe &#39;Bord&#39;&quot;</span><span class="p">)</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Je reconnais la classe &#39;Other&#39;
Je reconnais la classe &#39;Other&#39;
Je reconnais la classe &#39;Forward&#39;
Je reconnais la classe &#39;Forward&#39;
Je reconnais la classe &#39;Other&#39;
Je reconnais la classe &#39;Other&#39;
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">folders</span><span class="o">/</span><span class="mi">2</span><span class="n">y</span><span class="o">/</span><span class="n">mv3z1v0945b60_l2bzjwpzj80000gn</span><span class="o">/</span><span class="n">T</span><span class="o">/</span><span class="n">ipykernel_83580</span><span class="o">/</span><span class="mf">618073387.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> 
<span class="g g-Whitespace">     </span><span class="mi">24</span>     <span class="c1"># Take image from the camera</span>
<span class="ne">---&gt; </span><span class="mi">25</span>     <span class="n">picture_rgb</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">take_picture</span><span class="p">(</span><span class="n">camera_object</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> 
<span class="g g-Whitespace">     </span><span class="mi">27</span>     <span class="c1"># Predict image class</span>

<span class="nn">~/Projects/Scientotheque/fiches-ia/ai-rover-fr/03_Image_Recognition_Python/myfunctions.py</span> in <span class="ni">take_picture</span><span class="nt">(camera_object, input_image_size)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="k">def</span> <span class="nf">take_picture</span><span class="p">(</span><span class="n">camera_object</span><span class="p">,</span> <span class="n">input_image_size</span><span class="o">=</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span><span class="mi">224</span><span class="p">)):</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> 
<span class="ne">---&gt; </span><span class="mi">11</span>     <span class="n">return_status</span><span class="p">,</span> <span class="n">picture</span> <span class="o">=</span> <span class="n">camera_object</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> 
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">picture_rgb</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">picture</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2RGB</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="controle-du-rover-avec-la-reconnaissance-d-image">
<h2><span class="section-number">8.5. </span>Contrôle du rover avec la reconnaissance d’image<a class="headerlink" href="#controle-du-rover-avec-la-reconnaissance-d-image" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Necessary import</span>
<span class="kn">import</span> <span class="nn">cv2</span> <span class="c1"># cv2 is used to take image from the camera</span>
<span class="kn">import</span> <span class="nn">myfunctions</span> <span class="c1"># myfunctions helps for taking picture and making predictions</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span> <span class="c1"># matplotlib is used to deal with images</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span> <span class="c1"># PIL is used to deal with images</span>
<span class="kn">import</span> <span class="nn">time</span> <span class="c1"># time is used for making the computer wait</span>

<span class="c1"># Get camera object</span>
<span class="n">camera_object</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">VideoCapture</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">camera_object</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">CAP_PROP_BUFFERSIZE</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

<span class="c1"># Initialize model</span>
<span class="n">interpreter</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">initialize_model</span><span class="p">(</span><span class="n">model_path</span><span class="o">=</span><span class="s1">&#39;model.tflite&#39;</span><span class="p">)</span>

<span class="c1"># Infinite loop</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    
    <span class="c1"># Wait for one second</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Take image from the camera</span>
    <span class="n">picture_rgb</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">take_picture</span><span class="p">(</span><span class="n">camera_object</span><span class="p">)</span>
    
    <span class="c1"># Predict image class</span>
    <span class="n">prediction</span><span class="p">,</span> <span class="n">probability</span> <span class="o">=</span> <span class="n">myfunctions</span><span class="o">.</span><span class="n">model_prediction</span><span class="p">(</span><span class="n">interpreter</span><span class="p">,</span> <span class="n">picture_rgb</span><span class="p">)</span>
    
    <span class="c1"># If prediction is class 0, class is &#39;Tube&#39;</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Je reconnais la classe &#39;Tube&#39;&quot;</span><span class="p">)</span>
        
    <span class="c1"># If prediction is class 1, class is &#39;Autre&#39;</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Je reconnais la classe &#39;Other&#39;&quot;</span><span class="p">)</span>
        
        <span class="c1"># If prediction is class 2, class is &#39;Bord&#39;</span>
    <span class="k">if</span> <span class="n">prediction</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Je reconnais la classe &#39;Bord&#39;&quot;</span><span class="p">)</span>    
    
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./3_Rover_Camera_Control/FetchBot_Control_IR_Python"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../FetchBot_Control_IR_Scratch/FetchBot_Control_IR_Scratch.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7. </span>Contrôle du FetchBot et reconnaissance d’images avec Scratch</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../4_Additional_Resources/Raspberry_Pi/Raspberry_Pi.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">9. </span>Raspberry Pi: Prise en main et préparation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By <a href="https://www.lascientotheque.be/">La Scientothèque</a>, 2022.<br/>
        
          <div class="extra_footer">
            <p>
License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
</p>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>